## 요구사항 정리 

주어진 요구사항은 포인트 관리 시스템에서 사용자 포인트의 충전, 사용, 조회, 거래 내역 조회를 구현하는 것입니다. 각 기능은 **동시성 제어**를 필요로 하며, 시스템은 다음과 같은 동작을 수행해야 합니다:

1. **포인트 충전 (PATCH /point/{id}/charge)**
    - 사용자는 포인트를 충전할 수 있어야 한다.

2. **포인트 사용 (PATCH /point/{id}/use)**
    - 사용자는 포인트를 사용할 수 있어야 한다.
    - 잔고가 부족하면 포인트 사용에 실패해야 한다.

3. **포인트 잔액 조회 (GET /point/{id})**
    - 사용자는 자신의 현재 포인트 잔액을 조회할 수 있어야 한다.

4. **포인트 거래 내역 조회 (GET /point/{id}/histories)**
    - 사용자는 자신의 포인트 충전/사용 내역을 조회할 수 있어야 한다.

5. **동시성 제어**
    - 여러 사용자가 동시에 포인트를 충전하거나 사용할 때, 순차적으로 처리되어야 한다.

---

## 3-Tier 아키텍처 기반 컴포넌트 레이아웃 및 구현 순서

3-Tier 아키텍처는 **Presentation Layer (API/Controller)**, **Business Logic Layer (Service)**, **Data Access Layer (Repository)**로 구성되며, 각각의 요구사항을 어떻게 컴포넌트에 맞추어 구현할지 순서도를 작성했습니다.

#### 1. **포인트 충전 (PATCH /point/{id}/charge)**
- **Controller** (`PointController`):  
  `PATCH` 요청을 수신하고, 충전할 금액을 담은 DTO (`ChargeRequest`)를 서비스로 전달.
- **Service** (`PointService`):  
  충전 금액을 비즈니스 로직에서 처리하고, 사용자 포인트를 업데이트하며 충전 내역을 기록.
- **Repository** (`UserPointRepository`, `PointHistoryRepository`):  
  포인트 데이터를 업데이트하고 충전 내역을 기록.

#### 2. **포인트 사용 (PATCH /point/{id}/use)**
- **Controller** (`PointController`):  
  `PATCH` 요청을 수신하고, 사용할 금액을 담은 DTO (`UseRequest`)를 서비스로 전달.
- **Service** (`PointService`):  
  비즈니스 로직에서 포인트 사용을 처리하며, 잔액이 부족하면 예외 처리. 사용 내역을 기록.
- **Repository** (`UserPointRepository`, `PointHistoryRepository`):  
  포인트 데이터를 업데이트하고, 포인트 사용 내역을 기록.

#### 3. **포인트 잔액 조회 (GET /point/{id})**
- **Controller** (`PointController`):  
  `GET` 요청을 수신하고, 사용자 ID로 현재 잔액을 조회.
- **Service** (`PointService`):  
  사용자 포인트 정보를 조회하여 반환.
- **Repository** (`UserPointRepository`):  
  사용자 포인트 데이터를 조회.

#### 4. **포인트 거래 내역 조회 (GET /point/{id}/histories)**
- **Controller** (`PointController`):  
  `GET` 요청을 수신하고, 사용자 ID로 거래 내역을 조회.
- **Service** (`PointService`):  
  해당 사용자의 포인트 거래 내역을 조회하여 반환.
- **Repository** (`PointHistoryRepository`):  
  사용자 포인트 거래 내역 데이터를 조회.

#### 5. **동시성 제어**
- **Service** (`PointService`):  
  포인트 충전 및 사용 로직에 `ReentrantLock` 등 동시성 제어 메커니즘을 추가하여 여러 요청이 동시에 들어와도 순차적으로 처리.

---

## **포인트 관리 시스템 테스트 시나리오**

**포인트 시스템에서 발생할 수 있는 모든 경우의 수를 테스트하는 것이 중요합니다. 각 기능에 대해 정상 동작, 에러 상황, 경계값 및 동시성 문제를 다루는 다양한 테스트 케이스를 정의하여 시스템의 신뢰성과 일관성을 보장할 수 있습니다.

아래는 **TDD**를 기반으로 각 기능별로 발생할 수 있는 모든 경우의 수를 고려한 테스트 케이스 목록입니다.

---

## **1. 서비스 레이어 테스트 (PointServiceTest)**

### **1.1. 포인트 충전 테스트**

#### 1) **정상적인 포인트 충전**
- **상황**: 사용자가 포인트를 정상적으로 충전하는 경우.
- **입력**: 사용자 ID와 충전 금액이 유효함.
- **예상 결과**: 잔액이 충전 금액만큼 증가해야 함.

#### 2) **최대 포인트 한도 초과 충전**
- **상황**: 사용자가 최대 포인트 한도를 초과하여 충전하는 경우.
- **입력**: 충전 금액 + 기존 잔액 > 최대 포인트 한도.
- **예상 결과**: `IllegalArgumentException` 발생, 적절한 에러 메시지 반환.

#### 3) **충전 금액이 0일 경우**
- **상황**: 사용자가 충전 금액으로 0을 입력한 경우.
- **입력**: 충전 금액이 0.
- **예상 결과**: `IllegalArgumentException` 발생, "유효하지 않은 금액" 메시지 반환.

#### 4) **충전 금액이 음수일 경우**
- **상황**: 사용자가 음수 금액을 충전하려는 경우.
- **입력**: 충전 금액이 음수.
- **예상 결과**: `IllegalArgumentException` 발생, "유효하지 않은 금액" 메시지 반환.

#### 5) **존재하지 않는 사용자에게 충전 요청**
- **상황**: 존재하지 않는 사용자 ID로 충전 요청.
- **입력**: 잘못된 사용자 ID.
- **예상 결과**: `IllegalArgumentException` 발생, "잘못된 사용자 ID" 메시지 반환.

---

### **1.2. 포인트 사용 테스트**

#### 1) **정상적인 포인트 사용**
- **상황**: 사용자가 잔액 범위 내에서 포인트를 사용하는 경우.
- **입력**: 사용자 ID와 사용 금액이 유효함.
- **예상 결과**: 사용 금액만큼 잔액이 감소해야 함.

#### 2) **잔액이 부족한 경우**
- **상황**: 사용자가 잔액보다 더 많은 포인트를 사용하려는 경우.
- **입력**: 사용 금액 > 잔액.
- **예상 결과**: `IllegalArgumentException` 발생, "잔액이 부족합니다" 메시지 반환.

#### 3) **사용 금액이 0일 경우**
- **상황**: 사용자가 0 포인트를 사용하려는 경우.
- **입력**: 사용 금액이 0.
- **예상 결과**: `IllegalArgumentException` 발생, "유효하지 않은 금액" 메시지 반환.

#### 4) **사용 금액이 음수일 경우**
- **상황**: 사용자가 음수 금액을 사용하려는 경우.
- **입력**: 사용 금액이 음수.
- **예상 결과**: `IllegalArgumentException` 발생, "유효하지 않은 금액" 메시지 반환.

#### 5) **존재하지 않는 사용자에게 사용 요청**
- **상황**: 존재하지 않는 사용자 ID로 사용 요청.
- **입력**: 잘못된 사용자 ID.
- **예상 결과**: `IllegalArgumentException` 발생, "잘못된 사용자 ID" 메시지 반환.

---

### **1.3. 포인트 잔액 조회 테스트**

#### 1) **정상적인 잔액 조회**
- **상황**: 사용자가 자신의 잔액을 정상적으로 조회하는 경우.
- **입력**: 유효한 사용자 ID.
- **예상 결과**: 사용자 포인트 잔액이 정상적으로 반환됨.

#### 2) **잔액 조회 시 존재하지 않는 사용자**
- **상황**: 존재하지 않는 사용자 ID로 잔액을 조회하려는 경우.
- **입력**: 잘못된 사용자 ID.
- **예상 결과**: `IllegalArgumentException` 발생, "잘못된 사용자 ID" 메시지 반환.

---

### **1.4. 포인트 거래 내역 조회 테스트**

#### 1) **정상적인 거래 내역 조회**
- **상황**: 사용자가 자신의 포인트 거래 내역을 조회하는 경우.
- **입력**: 유효한 사용자 ID.
- **예상 결과**: 충전 및 사용 내역이 정확하게 반환됨.

#### 2) **거래 내역이 없는 경우**
- **상황**: 사용자의 거래 내역이 없는 경우.
- **입력**: 유효한 사용자 ID.
- **예상 결과**: 빈 리스트가 반환됨.

#### 3) **존재하지 않는 사용자의 거래 내역 조회**
- **상황**: 존재하지 않는 사용자 ID로 거래 내역을 조회하려는 경우.
- **입력**: 잘못된 사용자 ID.
- **예상 결과**: `IllegalArgumentException` 발생, "잘못된 사용자 ID" 메시지 반환.

---

### **2. 컨트롤러 테스트 (PointControllerTest)**

### **2.1. 포인트 충전 API 테스트**

#### 1) **정상적인 포인트 충전 요청**
- **상황**: 사용자가 포인트를 정상적으로 충전하는 요청을 보낼 때.
- **입력**: 유효한 사용자 ID 및 금액.
- **예상 결과**: `200 OK` 응답 및 "포인트 충전 완료" 메시지 반환.

#### 2) **존재하지 않는 사용자 ID로 충전 요청**
- **상황**: 존재하지 않는 사용자 ID로 충전 요청.
- **입력**: 잘못된 사용자 ID.
- **예상 결과**: `400 Bad Request` 응답 및 에러 메시지 반환.

#### 3) **잘못된 금액으로 충전 요청**
- **상황**: 충전 금액이 0이거나 음수일 경우.
- **입력**: 잘못된 금액.
- **예상 결과**: `400 Bad Request` 응답 및 에러 메시지 반환.

---

### **2.2. 포인트 사용 API 테스트**

#### 1) **정상적인 포인트 사용 요청**
- **상황**: 사용자가 잔액 범위 내에서 포인트 사용 요청.
- **입력**: 유효한 사용자 ID 및 금액.
- **예상 결과**: `200 OK` 응답 및 "포인트 사용 완료" 메시지 반환.

#### 2) **잔액 부족 시 포인트 사용 요청**
- **상황**: 사용자가 잔액보다 더 많은 포인트를 사용하려는 요청.
- **입력**: 사용 금액이 잔액보다 큼.
- **예상 결과**: `400 Bad Request` 응답 및 에러 메시지 반환.

#### 3) **잘못된 금액으로 포인트 사용 요청**
- **상황**: 포인트 사용 금액이 0이거나 음수일 경우.
- **입력**: 잘못된 금액.
- **예상 결과**: `400 Bad Request` 응답 및 에러 메시지 반환.

---

### **2.3. 포인트 잔액 조회 API 테스트**

#### 1) **정상적인 잔액 조회 요청**
- **상황**: 사용자가 자신의 잔액을 조회하는 요청.
- **입력**: 유효한 사용자 ID.
- **예상 결과**: `200 OK` 응답 및 잔액이 반환됨.

#### 2) **존재하지 않는 사용자 ID로 잔액 조회**
- **상황**: 존재하지 않는 사용자 ID로 잔액 조회 요청.
- **입력**: 잘못된 사용자 ID.
- **예상 결과**: `400 Bad Request` 응답 및 에러 메시지 반환.

---

### **2.4. 포인트 거래 내역 조회 API 테스트**

#### 1) **정상적인 거래 내역 조회 요청**
- **상황**: 사용자가 자신의 거래 내역을 조회하는 요청.
- **입력**: 유효한 사용자 ID.
- **예상 결과**: `200 OK` 응답 및 거래 내역이 반환됨.

#### 2) **거래 내역이 없는 경우**
- **상황**: 사용자의 거래 내역이 없을 때.
- **입력**: 유효한 사용자 ID.
- **예상 결과**: `200 OK` 응답 및 빈 리스트 반환.

#### 3) **존재하지 않는 사용자 ID로 거래 내역 조회**
- **상황**: 존재하지 않는 사용자 ID로 거래 내역 조회 요청.
- **입력**: 잘못된 사용자 ID.
- **예상 결과**: `400 Bad Request` 응답 및 에러 메시지 반환

.

---

## **3. 동시성 테스트 (PointServiceConcurrencyTest)**

### **3.1. 동시 포인트 충전 테스트**

#### 1) **동시 포인트 충전 요청**
- **상황**: 여러 스레드가 동시에 동일한 사용자에 대해 포인트 충전 요청을 보낼 때.
- **입력**: 여러 스레드에서 동일한 사용자 ID와 충전 금액.
- **예상 결과**: 각 충전 금액이 정확하게 반영되고, 동시성 문제가 발생하지 않음.

---

### **3.2. 동시 포인트 사용 테스트**

#### 1) **동시 포인트 사용 요청**
- **상황**: 여러 스레드가 동시에 동일한 사용자에 대해 포인트 사용 요청을 보낼 때.
- **입력**: 여러 스레드에서 동일한 사용자 ID와 사용 금액.
- **예상 결과**: 각 사용 금액이 정확하게 반영되고, 동시성 문제가 발생하지 않음.

---

### **3.3. 동시 포인트 충전 및 사용 테스트**

#### 1) **동시 포인트 충전 및 사용 요청**
- **상황**: 여러 스레드가 동시에 동일한 사용자에 대해 충전과 사용 요청을 보낼 때.
- **입력**: 여러 스레드에서 동일한 사용자 ID에 대해 충전과 사용 요청이 동시에 발생.
- **예상 결과**: 충전과 사용 금액이 정확하게 반영되고, 동시성 문제가 발생하지 않음.

---

## **결론**

이 테스트 케이스 목록은 **정상적인 동작, 예외 처리, 경계 상황**을 모두 포함하여 포인트 시스템에서 발생할 수 있는 모든 시나리오를 검증합니다. 이를 통해 **TDD** 방식으로 개발을 진행할 때, 각각의 테스트를 먼저 작성하고, 이를 만족시키기 위해 코드를 구현함으로써 **안정적이고 신뢰성 높은 시스템**을 구축할 수 있습니다.